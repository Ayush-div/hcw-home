<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Join Consultation</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="join-container">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <ion-spinner name="dots" color="primary"></ion-spinner>
      <ion-text>
        <h2>Joining Consultation</h2>
        <p>Please wait while we connect you...</p>
      </ion-text>
    </div>

    <!-- Error State -->
    <div *ngIf="!isLoading && errorMessage" class="error-container">
      <ion-card class="error-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
            Unable to Join
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-text color="danger">
            <p>{{errorMessage}}</p>
          </ion-text>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <!-- Retry button -->
            <ion-button
              expand="block"
              color="primary"
              (click)="retryJoin()"
              *ngIf="token || consultationId"
            >
              <ion-icon name="refresh-outline" slot="start"></ion-icon>
              Try Again
            </ion-button>

            <!-- Login button for auth errors -->
            <ion-button
              expand="block"
              fill="outline"
              color="primary"
              (click)="goToLogin()"
              *ngIf="errorMessage.includes('log in') || errorMessage.includes('Login')"
            >
              <ion-icon name="person-outline" slot="start"></ion-icon>
              Login to Continue
            </ion-button>

            <!-- Dashboard button -->
            <ion-button
              expand="block"
              fill="clear"
              color="medium"
              (click)="goToDashboard()"
            >
              <ion-icon name="home-outline" slot="start"></ion-icon>
              Go to Dashboard
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Help Section -->
      <ion-card class="help-card">
        <ion-card-header>
          <ion-card-title>Need Help?</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ul>
            <li>Make sure your consultation link is valid and hasn't expired</li>
            <li>Check that you're logged into the correct account</li>
            <li>Ensure you have a stable internet connection</li>
            <li>Contact your healthcare provider if the problem persists</li>
          </ul>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Success State (rarely shown due to immediate redirect) -->
    <div *ngIf="!isLoading && !errorMessage" class="success-container">
      <ion-card class="success-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="checkmark-circle-outline" color="success"></ion-icon>
            Joining Consultation
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>You're being redirected to your consultation...</p>
          <ion-spinner name="dots" color="success"></ion-spinner>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>
              Go to Login
            </ion-button>

            <ion-button
              expand="block"
              fill="clear"
              color="medium"
              (click)="goToDashboard()"
            >
              Go to Dashboard
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Success State (brief display before redirect) -->
    <div *ngIf="!isLoading && !errorMessage" class="success-container">
      <ion-card class="success-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            Joining Consultation
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-text color="success">
            <p>Successfully processed consultation link!</p>
          </ion-text>
          <ion-spinner name="dots"></ion-spinner>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>
